<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>$ASP BuildKey / 早鸟资格 批量查询</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gray-100 flex flex-col items-center py-8 px-4">
  <h1 class="text-2xl font-bold mb-6">$ASP BuildKey / 早鸟资格 批量查询</h1>

  <!-- 输入区 -->
  <div class="w-full max-w-3xl bg-white shadow rounded-lg p-6 mb-8">
    <label for="addrInput" class="block text-sm font-medium text-gray-700 mb-2">
      请输入 Solana 地址（每行一个）：
    </label>
    <textarea id="addrInput" rows="6"
      class="w-full border rounded-md p-3 focus:ring-indigo-500 focus:border-indigo-500 text-sm placeholder-gray-400"
      placeholder=""></textarea>
    <button id="searchBtn"
      class="mt-4 inline-flex items-center px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium rounded">
      查询
    </button>
    <p id="statusMsg" class="text-sm text-gray-600 mt-3"></p>
  </div>

  <!-- 结果统计 -->
  <div id="summary" class="w-full max-w-3xl mb-6"></div>

  <!-- 结果表格 -->
  <div id="results" class="w-full max-w-5xl space-y-10"></div>

  <footer class="mt-auto text-sm text-gray-500">
    Build by <a href="https://twitter.com/0xXIAOc" target="_blank" class="text-indigo-600">@0xXIAOc</a>
  </footer>

<script>
// -------- 全局数据 --------
const db = new Map();      // address => category: 'both' | 'buildKey'
let dataReady = false;

// -------- 帮助函数 --------
function parseLine(line){
  if(!line.trim()) return null;
  // 数据列用制表符或逗号分隔。前两列可能是序号/地址；后面是奖励描述
  const parts = line.split(/\t|,/).map(p=>p.trim());
  // 如果第一列是序号，地址在第二列；否则地址在第一列
  let addr = parts[0];
  if(/^(\d+)$/.test(addr) && parts[1]) addr = parts[1];
  if(!/^([1-9A-HJ-NP-Za-km-z]{32,44})$/.test(addr)) return null; // 粗略检测 Sol 地址

  const rewardTxt = parts.slice(2).join(' ').toLowerCase();
  const isEarly   = rewardTxt.includes('early access');   // TGE Early Access Eligibility
  const isBuild   = rewardTxt.includes('buildkey');       // BuildKey mention

  if(!isEarly && !isBuild) return null;

  return {addr, category: isEarly ? 'both' : 'buildKey'};
}

// -------- 载入 data.txt --------
fetch('data.txt')
  .then(r => r.text())
  .then(txt => {
    txt.split(/\r?\n/).forEach(line=>{
      const rec = parseLine(line);
      if(rec) db.set(rec.addr, rec.category);
    });
    dataReady = true;
    document.getElementById('statusMsg').textContent =
      `数据加载完成，共 ${db.size} 条记录。`;
  })
  .catch(err=>{
    console.error(err);
    document.getElementById('statusMsg').textContent =
      '加载 data.txt 失败，请检查文件路径。';
  });

// -------- 查询逻辑 --------
document.getElementById('searchBtn').addEventListener('click', ()=>{
  if(!dataReady){ alert('数据尚未加载完成，请稍候再试'); return;}

  const raw = document.getElementById('addrInput').value.trim();
  if(!raw){ alert('请输入至少一个地址'); return; }

  const list = raw.split(/\r?\n/).map(a=>a.trim()).filter(Boolean);
  const both=[], buildOnly=[], miss=[];

  list.forEach(a=>{
    const cat = db.get(a);
    if(cat==='both')      both.push(a);
    else if(cat==='buildKey') buildOnly.push(a);
    else                miss.push(a);
  });

  // ---- 概览 ----
  document.getElementById('summary').innerHTML = `
  <div class="grid grid-cols-3 gap-4 text-center">
    <div class="bg-white shadow p-4 rounded">
      <p class="text-sm text-gray-500">输入总数</p>
      <p class="text-xl font-semibold">${list.length}</p>
    </div>
    <div class="bg-white shadow p-4 rounded">
      <p class="text-sm text-gray-500">早鸟 + BuildKey</p>
      <p class="text-xl font-semibold text-green-600">${both.length}</p>
    </div>
    <div class="bg-white shadow p-4 rounded">
      <p class="text-sm text-gray-500">仅 BuildKey</p>
      <p class="text-xl font-semibold text-indigo-600">${buildOnly.length}</p>
    </div>
  </div>`;

  // ---- 结果表格 ----
  const results = document.getElementById('results');
  results.innerHTML = '';

  const makeTable = (title, arr, color) => arr.length ? `
    <div>
      <h2 class="text-lg font-medium mb-2 text-${color}-600">${title}（${arr.length}）</h2>
      <div class="overflow-x-auto bg-white shadow rounded">
        <table class="min-w-full text-left text-sm"><tbody>
          ${arr.map(a=>`<tr class="border-b"><td class="px-4 py-2 font-mono text-xs break-all">${a}</td></tr>`).join('')}
        </tbody></table>
      </div>
    </div>` : '';

  results.insertAdjacentHTML('beforeend', makeTable('早鸟 + BuildKey 资格', both, 'green'));
  results.insertAdjacentHTML('beforeend', makeTable('仅 BuildKey 资格', buildOnly, 'indigo'));
  results.insertAdjacentHTML('beforeend', makeTable('未找到（请确认地址）', miss, 'red'));
});
</script>
</body>
</html>
